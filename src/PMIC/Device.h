#include <SPMI.h>

EXTERN_C_START

#define PMIC_REG_SUBTYPE 0x105
#define MAX_PMIC_NUMBER 16

typedef enum
{
    PMIC_UNKNOWN = 0,
    PMIC_PM8150  = 30,
    PMIC_PM8250  = PMIC_PM8150,
    PMIC_PM8150L = 31,
    PMIC_PM7150L = PMIC_PM8150L,
    PMIC_PM6150L = PMIC_PM8150L,
    PMIC_PM8150B = 32,
    PMIC_PMK8002 = 33,
    PMIC_PM8009  = 36,
    PMIC_PM8150A = 39,
    PMIC_PM7150A = PMIC_PM8150A,
    PMIC_PM6150A = PMIC_PM8150A,
    PMIC_PM6150  = 40,
    PMIC_PM6250  = PMIC_PM6150,
    PMIC_PM7150  = PMIC_PM6150,
    PMIC_PMX55   = 42,
    PMIC_INVALID = 0x7FFFFFFF,
} PMIC_MODEL;

typedef struct _PMIC_INFO
{
    UINT32 Number;
    PMIC_MODEL Model;
    UINT8 SlaveID[2];
} PMIC_INFO, *PPMIC_INFO;

typedef struct _PMIC_IRQ_CONFIG
{
    UINT8 SlaveID;
    BOOLEAN IsInitialized;
} PMIC_IRQ_CONFIG, *PPMIC_IRQ_CONFIG;

typedef struct _DEVICE_CONTEXT
{
    SPMI_INTERFACE SPMIInterface;
    WDFDEVICE Device;
    UINT32 NumberOfPMICs;
    PMIC_INFO PMICList[MAX_PMIC_NUMBER];
} DEVICE_CONTEXT, *PDEVICE_CONTEXT;

WDF_DECLARE_CONTEXT_TYPE_WITH_NAME(DEVICE_CONTEXT, DeviceGetContext)

NTSTATUS
PMICCreateDevice(
    _Inout_ PWDFDEVICE_INIT DeviceInit
    );

EXTERN_C_END
